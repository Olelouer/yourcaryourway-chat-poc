<div class="dashboard-container">

    <div class="user-list-panel">
        <h3>Conversations</h3>
        <ul>
            @for (conv of conversations; track conv.conversationId) {
            <li (click)="selectConversation(conv)"
                [class.active]="conv.conversationId === selectedConversation?.conversationId">

                <strong>{{ conv.userFirstName }} {{ conv.userLastName }}</strong>
                <br>
                <small>Statut: {{ conv.status }}</small>
                <br>
                <small>{{ conv.lastMessageTime | date:'shortTime' }}</small>
            </li>
            }
            @empty {
            <li>Aucune conversation assignée.</li>
            }
        </ul>
    </div>

    <div class="chat-panel">

        @if (selectedConversation) {

        <div class="chat-header">
            <h4>Discussion avec {{ selectedConversation.userFirstName }}</h4>
        </div>

        <div class="message-list">
            @for (msg of messages; track msg.id) {
            @if (msg.senderType === 'user') {
            <div class="message user-message">
                <strong>{{ msg.senderName }}:</strong>
                {{ msg.message }}
            </div>
            } @else {
            <div class="message agent-message">
                <strong>{{ msg.senderName }} (Moi):</strong>
                {{ msg.message }}
            </div>
            }
            } @empty {
            <p class="chat-placeholder">Aucun message.</p>
            }
        </div>

        <div class="message-input">
            <input type="text" [(ngModel)]="newMessageText" (keyup.enter)="sendMessage()"
                placeholder="Répondre à {{ selectedConversation.userFirstName }}...">
            <button (click)="sendMessage()">Envoyer</button>
        </div>

        } @else {
        <div class="chat-placeholder">
            <p>Sélectionnez une conversation pour commencer.</p>
        </div>
        }

    </div>
</div>